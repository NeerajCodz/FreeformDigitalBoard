generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("POSTGRES_URL")
}

// User model - using Clerk user ID as primary identifier
model User {
  id                    String    @id @default(cuid())
  clerk_user_id         String    @unique
  email                 String    @unique
  email_verified        Boolean   @default(false)
  first_name            String?
  last_name             String?
  username              String?   @unique
  image_url             String?
  phone_number          String?
  phone_verified        Boolean   @default(false)
  last_sign_in_at       DateTime?
  created_at            DateTime  @default(now())
  updated_at            DateTime  @updatedAt

  // Relations
  categories            Category[]
  labels                Label[]
  boards                Board[]
  boardSnapshots        BoardSnapshot[]
  tags                  Tag[]

  @@map("users")
}

// Category model - for organizing board pins
model Category {
  id            String    @id @default(cuid())
  clerk_user_id String
  name          String
  color         String?   @default("#3B82F6")
  description   String?
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt

  // Relations
  user          User      @relation(fields: [clerk_user_id], references: [clerk_user_id])

  @@map("categories")
  @@index([clerk_user_id])
}

// Label model - for tagging board pins
model Label {
  id            String    @id @default(cuid())
  clerk_user_id String
  name          String
  color         String?   @default("#10B981")
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt

  // Relations
  user          User      @relation(fields: [clerk_user_id], references: [clerk_user_id])

  @@map("labels")
  @@index([clerk_user_id])
}

// Tag model - for tagging entire boards
model Tag {
  id            String    @id @default(cuid())
  clerk_user_id String
  name          String
  color         String?   @default("#F59E0B")
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt

  // Relations
  user          User      @relation(fields: [clerk_user_id], references: [clerk_user_id])

  @@map("tags")
  @@index([clerk_user_id])
}

// Free-form board that stores all pin data in a JSON blob for quick read/write
model Board {
  id             String    @id @default(cuid())
  clerk_user_id  String
  title          String
  description    String?
  tag_ids        String[]  @default([]) // Store tag IDs for this board
  state          Json      @default("{}") // Serialized board state (pins, groups, viewport)
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt

  user      User             @relation(fields: [clerk_user_id], references: [clerk_user_id])
  snapshots BoardSnapshot[]

  @@map("boards")
  @@index([clerk_user_id])
}

// Saved snapshots of a board so users can version their layout
model BoardSnapshot {
  id            String   @id @default(cuid())
  board_id      String
  clerk_user_id String
  name          String
  note          String?
  state         Json
  created_at    DateTime @default(now())

  board Board @relation(fields: [board_id], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [clerk_user_id], references: [clerk_user_id], onDelete: Cascade)

  @@map("board_snapshots")
  @@index([board_id])
  @@index([clerk_user_id])
}
