generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("POSTGRES_URL")
}

model User {
  id              String          @id @default(cuid())
  clerk_user_id   String          @unique
  email           String          @unique
  email_verified  Boolean         @default(false)
  first_name      String?
  last_name       String?
  username        String?         @unique
  image_url       String?
  phone_number    String?
  phone_verified  Boolean         @default(false)
  last_sign_in_at DateTime?
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  boardSnapshots  BoardSnapshot[]
  boards          Board[]
  categories      Category[]
  tags            Tag[]

  @@map("users")
}

model Category {
  id            String   @id @default(cuid())
  clerk_user_id String
  name          String
  color         String?  @default("#3B82F6")
  description   String?
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  user          User     @relation(fields: [clerk_user_id], references: [clerk_user_id])

  @@index([clerk_user_id])
  @@map("categories")
}

// Label model - for tagging individual pins within a board (pin-level, board-scoped)
model Label {
  id        String   @id @default(cuid())
  boardId   String   @map("board_id")
  name      String
  color     String?  @default("#10B981")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  board     Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)

  @@index([boardId])
  @@map("labels")
}

// Group model - for grouping pins within a board (pin-level, board-scoped)
model Group {
  id        String   @id @default(cuid())
  boardId   String   @map("board_id")
  name      String
  color     String?  @default("#8B5CF6")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  board     Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)

  @@index([boardId])
  @@map("groups")
}

model Tag {
  id            String   @id @default(cuid())
  clerk_user_id String
  name          String
  color         String?  @default("#F59E0B")
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  description   String?
  user          User     @relation(fields: [clerk_user_id], references: [clerk_user_id])

  @@index([clerk_user_id])
  @@map("tags")
}

model Board {
  id            String          @id @default(cuid())
  clerk_user_id String
  title         String
  description   String?
  tag_ids       String[]        @default([])
  category_ids  String[]        @default([])
  state         Json            @default("{}")
  created_at    DateTime        @default(now())
  updated_at    DateTime        @updatedAt
  snapshots     BoardSnapshot[]
  labels        Label[]
  groups        Group[]
  user          User            @relation(fields: [clerk_user_id], references: [clerk_user_id])

  @@index([clerk_user_id])
  @@map("boards")
}

model BoardSnapshot {
  id            String   @id @default(cuid())
  board_id      String
  clerk_user_id String
  name          String
  note          String?
  state         Json
  created_at    DateTime @default(now())
  board         Board    @relation(fields: [board_id], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [clerk_user_id], references: [clerk_user_id], onDelete: Cascade)

  @@index([board_id])
  @@index([clerk_user_id])
  @@map("board_snapshots")
}
